---
title: "Fun-w-Rtools40"
author: "David Jackson"
date: "Oct. 30,2020"
output: 
  html_document: 
    fig_width: 10
    fig_height: 10
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,message = FALSE,error = FALSE)
library(ggplot2)
library(scales)
library(dplyr)
library(tidyr)
library(readr)

```
```{r}
rm(list=ls())
WeeklyAge <- read_csv("./DATA/Week_Sex__Age.csv")
WeeklyAge <-janitor::clean_names(WeeklyAge)
WeeklyAge <- WeeklyAge %>% select(state,end_week,sex,age_group,total_deaths,covid_19_deaths)
colnames(WeeklyAge) <- c("State","Date","Sex","Age","Deaths","Covid19")
WeeklyAge$Date <- gsub("/","-",WeeklyAge$Date)
WeeklyAge$Date <- as.Date(WeeklyAge$Date,format="%m-%d-%Y")
mean(WeeklyAge$Deaths)
mean(WeeklyAge$Covid19)
```

###  All Ages by Date

```{r}
all_age <- subset(WeeklyAge,Age !="All Ages" & Sex=="All Sex")

```
```{r}
ggplot(all_age) + geom_col(aes(x=Age,y=Covid19)) + coord_flip() +
  labs(title="Total COVID19 Deaths by Age Group")
```

```{r}
all_sex <- subset(WeeklyAge,Age !="All Ages")
ggplot(all_sex) + geom_col(aes(x=Age,y=Covid19)) + coord_flip() +
  labs(title="Total COVID19 Deaths by Age Group and Sex") +
  facet_wrap(~Sex) + theme(axis.text.x = element_text(angle = 90))
  
```
```{r}
not_all_ages <- subset(all_sex, Age %in% c("55-64 years","65-74 years","75-84 years","85 years and over") & Date >="2020-03-01")
ggplot(not_all_ages) + geom_line(aes(x=Date,y=Covid19,col="Deaths")) + facet_wrap(~Age,ncol=2) +
  labs(title="COVID19 Deaths by Week for Age Groups >= 55") +
  geom_smooth(aes(x=Date,y=Covid19,col="Loess"),span=0.25)
  
```

### Total Deaths and Percentage of Deaths by Age Group

```{r}
rm(list=ls())
CDCAge <- data.table::fread("./DATA/State_Sex__Age.csv")
CDCAge <- janitor::clean_names(CDCAge)

```

```{r}
# CDCAge %>% filter(age_group != "All Ages" & sex != "All") %>%
# ggplot() + geom_col(aes(x=age_group,y=total_deaths)) +
#   theme(axis.text.x = element_text(angle = 45)) +
#   labs(title="Total Deaths by Age Group",x="Age Group",y="Total Deaths") +
#   scale_y_continuous(labels = scales::comma)
#   
  
```
```{r}
CDCAge %>% filter(age_group != "All Ages" & sex != "All") %>%
ggplot() + geom_col(aes(x=age_group,y=total_deaths/sum(total_deaths,na.rm=TRUE))) +
  theme(axis.text.x = element_text(angle = 45)) + 
  scale_y_continuous(labels=percent) +
  labs(title="Deaths by Age Group as Percentage",x="Age Group",y="% of Age") 
```

